<?php

/**
 * @file
 * Module file of the TMGMT DGT connector.
 */

/**
 * Implements hook_entity_info_alter().
 */
function tmgmt_dgt_connector_entity_info_alter(&$entity_info) {
  $entity_info['tmgmt_job']['controller class'] = 'TMGMTPoetryJobController';
  $entity_info['tmgmt_job']['entity class'] = 'TMGMTPoetryJob';
  $entity_info['tmgmt_translator']['access callback'] = '_tmgmt_dgt_connector_translator_access';
}

/**
 * Implements hook_tmgmt_translator_plugin_info().
 */
function tmgmt_dgt_connector_tmgmt_translator_plugin_info() {
  return array(
    'tmgmt_dgt_connector' => array(
      'label' => t('TMGMT DGT Connector'),
      'description' => t('TMGMT DGT Connector Translation service.'),
      'plugin controller class' => 'TmgmtDgtConnectorTranslatorPluginController',
      'ui controller class' => 'TmgmtDgtConnectorTranslatorUIController',
    ),
  );
}

/**
 * Custom function to manage permissions of the tmgmt_dgt_connector translator.
 *
 * @param string $op
 *   Which operation is performed.
 * @param array $translator
 *   The translator the operation is performed on.
 * @param array $account
 *   The account which is performing the update.
 *
 * @return bool
 *   Boolean
 */
function _tmgmt_dgt_connector_translator_access($op, $translator, $account) {
  if (!empty($translator) && $translator->plugin == 'tmgmt_dgt_connector') {
    if ($op == 'delete') {
      return FALSE;
    }
    else {
      return user_access('manage feature nexteuropa_dgt_connector');
    }
  }
  else {
    return tmgmt_translator_access($op, $translator, $account);
  }

}
